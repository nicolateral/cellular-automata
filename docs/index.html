<html>
    <head>
        <link href="style/style.css" rel="stylesheet" type="text/css">
        <script type="text/javascript" src="lib/automata.js"></script>
        <script type="text/javascript" src="src/patterns.js"></script>
        <script type="text/javascript" src="src/control.js"></script>
        <title>Cellular Automata JS Library</title>
    </head>
    <body>
        <div id="app" class="flex-box flex-v">
            <div id="header" class="flex-box flex-h">
                <div id="title">
                    Cellular Automata JS Library
                </div>
                <div id="controls" class="flex-box flex-h">
                    <a onclick="playResume(this)">Play</a>
                    <a onclick="slowerFaster(this)">Faster</a>
                    <a onclick="randomize()">Randomize</a>
                    <a onclick="colorAB(this)">Color B</a>
                    <a onclick="ruleAB(this)">Rule B</a>
                    <a onclick="clearLayer()">Clear</a>
                </div>
                <div>
                    <a href="jsdoc/index.html" target="_blank">Docs</a>
                </div>
            </div>
            <div id="page" class="flex-box flex-h">
                
            </div>
            <div id="footer">Cellular Automata JS Library is open source, see <a href="https://github.com/nicolateral/cellular-automata">Github Repository</a></div>
        </div>
    </body>
    <script type="text/javascript">

        var page = document.getElementById('page'),
            height = page.offsetHeight,
            width = page.offsetWidth; 


        // Automata
        const automata = new Automata.Automata(document.getElementById('page'), {
            delay: 200,
            step: 10,
            height: Math.floor(height / 10) - 1,
            width: Math.floor(width / 10) - 1
        });

        // Layer
        automata.addCellularLayer({
            id: 'layer-0',
            colors: {
                'a': function() {
                    return 'rgba(0, 0, 0, 0.7)';
                },
                'b': function() {
                    return 'rgba(' + Math.floor(Math.random() * 255) + ', ' + Math.floor(Math.random() * 255) + ', ' + Math.floor(Math.random() * 255) + ', 0.7)';
                }
            },
            patterns: {
                'empty': function() {
                    return [];
                },
                'random': function() {
                    var random = [],
                        i, j;

                    for (i = 0; i < automata.getSize().width; i++) {
                        for (j = 0; j < automata.getSize().height; j++) {
                            if (Math.round(Math.random())) {
                                random.push({
                                    x: i,
                                    y: j
                                });
                            }
                        }
                    }

                    // Load
                    return random;
                }
            },
            rules: {
                'a': function(cell) {
                    var count = 0;

                    cell.getNeighbors().forEach(function(neighbor) {
                        if (neighbor.isAlive()) {
                            count += 1;
                        }
                    });

                    if (!cell.isAlive()) {
                        if (count === 3) {
                            return true;
                        }
                    } else {
                        if (!(count === 2 || count === 3)) {
                            return false;
                        }
                    }

                    return cell.isAlive();
                },
                'b': function(cell) {
                    var count = 0;
                    
                    cell.getNeighbors().forEach(function(neighbor) {
                        if (neighbor.isAlive()) {
                            count += 1;
                        }
                    });

                    if (cell.isAlive()) {
                        return false;
                    }

                    return count === 1;
                }
            },
            rule: 'a',
            color: 'a',
            pattern: 'random'
        });

        // PlayResume
        const playResume = function(element) {
            if (automata.getOption('started')) {
                element.innerHTML = 'Resume';
            } else {
                element.innerHTML = 'Pause';
            }
            automata.setOption('started', !automata.getOption('started'));
        };

        // SlowerFaster
        const slowerFaster = function(element) {
            if (automata.getOption('delay') === 0) {
                element.innerHTML = 'Faster';
                automata.setOption('delay', 200);
            } else {
                element.innerHTML = 'Slower';
                automata.setOption('delay', 0);
            }
        };

        // Randomize
        const randomize = function() {
            automata.getLayer('layer-0').setOption('pattern', 'random', true);
        };

        // Clear
        const clearLayer = function() {
            if (automata.getOption('started')) {
                automata.setOption('started', false);
            }
            automata.getLayer('layer-0').setOption('pattern', 'empty', true);
        };
        
        // Const
        const colorAB = function(element) {
            if (automata.getLayer('layer-0').getOption('color') === 'a') {
                element.innerHTML = 'Color A';
                automata.getLayer('layer-0').setOption('color', 'b');
            } else {
                element.innerHTML = 'Color B';
                automata.getLayer('layer-0').setOption('color', 'a');
            }
        }

        // Const
        const ruleAB = function(element) {
            if (automata.getLayer('layer-0').getOption('rule') === 'a') {
                element.innerHTML = 'Rule A';
                automata.getLayer('layer-0').setOption('rule', 'b');
            } else {
                element.innerHTML = 'Rule B';
                automata.getLayer('layer-0').setOption('rule', 'a');
            }
        }

        // Repaint
        automata.repaint();
    </script>
</html>