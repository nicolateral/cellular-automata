var Automata={DefaultCellStateProvider:{getNextState(t){var e=0;if(t.getNeighbors().forEach((function(t){1===t.getState()&&(e+=1)})),0===t.getState()){if(3===e)return 1}else if(2!==e&&3!==e)return 0;return t.getState()},getColor:t=>1===t?"rgba(0, 0, 0, 0.7)":"transparent"},Object:class{#events={};constructor(t){}listen(t,e){this.#events[t]||(this.#events[t]=[]),this.#events[t].push(e)}mute(t,e){var s;if(this.#events[t])for(s=this.#events[t].length-1;s>=0;s--)this.#events[t][s].id===e&&this.#events[t].splice(s,1)}fireEvent(t,e){this.#events[t]&&this.#events[t].forEach((function(t){t.fn.apply(t.scope||this,e)}),this)}}};Automata.Automata=class extends Automata.Object{#delay=10;#height=10;#step=10;#width=10;#last=null;#layers=[];#element=null;#started=!1;constructor(t,e){super(e),e&&(void 0!==e.delay&&this.setDelay(e.delay),void 0!==e.height&&this.setHeight(e.height),void 0!==e.step&&this.setStep(e.step),void 0!==e.width&&this.setWidth(e.width)),this.#element=t,this.addLayer(new Automata.BackgroundLayer(this,{id:"background"})),this.addLayer(new Automata.InfoLayer(this,{id:"info"})).getCanvas().style.zIndex=10,this.addLayer(new Automata.Layer(this,{id:"event"})).getCanvas().style.zIndex=20,this.#initEventLayer()}#initEventLayer(){this.getLayer("event").getCanvas().addEventListener("mousedown",this.#onMouseDown.bind(this))}#getEventX(t){return t.layerX}#getEventY(t){return t.layerY}#onMouseDown(t){this.propagateEvent("mousedown",{x:this.#getEventX(t),y:this.#getEventY(t)})}#reziseLayers(){this.getLayers().forEach((function(t){t.resize()}))}#requestAnimationFrame(){var t=this;requestAnimationFrame((function(){t.next(),t.repaint()}))}propagateEvent(t,e){this.getLayers().forEach((function(s){s.propagateEvent(t,e)}))}getElement(){return this.#element}addLayer(t){return this.#layers.push(t),t.resize(),t}addCellularLayer(t){return this.addLayer(new Automata.CellularLayer(this,t))}getLayer(t){var e,s=this.#layers;for(e=0;e<s.length;e++)if(s[e].getId()===t)return s[e];return null}getDelay(){return this.#delay}getHeight(){return this.#height}getLayers(){return this.#layers}getStep(){return this.#step}getWidth(){return this.#width}setDelay(t){this.#delay=t}setHeight(t){this.#height=t,this.#reziseLayers()}setStep(t){this.#step=t,this.#reziseLayers()}setWidth(t){this.#width=t,this.#reziseLayers()}setStarted(t){var e=this.isStarted();this.#started=t,t&&!e&&this.repaint()}isStarted(){return this.#started}pause(){this.setStarted(!1)}start(){this.setStarted(!0)}next(){this.getLayers().forEach((function(t){t.next()}))}repaint(){var t=this,e=Date.now(),s=this.getDelay();this.isStarted()?(this.#last&&this.getLayer("info").setFPS(Math.round(1e3/(e-this.#last))),this.#last=e):this.getLayer("info").setFPS(0),this.getLayers().forEach((function(t){t.repaint()})),this.isStarted()&&(s?setTimeout((function(){t.#requestAnimationFrame()}),s):t.#requestAnimationFrame())}},Automata.Layer=class extends Automata.Object{#id=null;#autoClear=!0;#dirty=!0;#canvas=null;#automata=null;constructor(t,e){super(e),e&&e.id&&this.setId(e.id),this.#automata=t,this.#createElement()}#createElement(){this.#canvas=document.createElement("canvas"),this.#canvas.id=this.getId(),this.#canvas.style.position="absolute",this.getAutomata().getElement().appendChild(this.#canvas)}propagateEvent(t,e){}resize(){var t=this.getAutomata(),e=t.getStep(),s=t.getHeight()*e,a=t.getWidth()*e;this.#canvas.height=s,this.#canvas.width=a,a<t.getElement().offsetWidth?this.#canvas.style.left=Math.round((t.getElement().offsetWidth-a)/2)+t.getElement().offsetLeft:this.#canvas.style.left=0,s<t.getElement().offsetHeight?this.#canvas.style.top=Math.round((t.getElement().offsetHeight-s)/2)+t.getElement().offsetTop:this.#canvas.style.top=0,this.setDirty(!0)}setAutoClear(t){this.#autoClear=t}getAutomata(){return this.#automata}getCanvas(){return this.#canvas}getContext(t){return this.getCanvas().getContext(t)}getId(){return this.#id}isDirty(){return this.#dirty}setDirty(t){this.#dirty=t}setId(t){this.#id=t}next(){}repaint(){if(this.isDirty()){var t=this.getContext("2d"),e=this.getAutomata(),s=e.getStep();this.#autoClear&&t.clearRect(0,0,e.getWidth()*s,e.getHeight()*s),this.redraw(this.getContext("2d")),this.setDirty(!1)}}redraw(t){}},Automata.BackgroundLayer=class extends Automata.Layer{redraw(t){var e,s=this.getAutomata(),a=s.getHeight(),i=s.getWidth(),r=s.getStep();for(t.beginPath(),t.strokeStyle="#F0F0F0",e=1;e<i;e++)t.moveTo(e*r,0),t.lineTo(e*r,a*r),t.stroke();for(e=1;e<a;e++)t.moveTo(0,e*r),t.lineTo(i*r,e*r),t.stroke();t.closePath()}},Automata.InfoLayer=class extends Automata.Layer{#fps=0;setFPS(t){this.#fps!==t&&this.setDirty(!0),this.#fps=t}redraw(t){t.clearRect(5,5,80,40),t.fillStyle="#FFFFFFDD",t.fillRect(5,5,60,40),t.fillStyle="#000000",t.fillText("FPS: "+this.#fps,10,20),t.fillText("Height: "+this.getAutomata().getHeight(),10,30),t.fillText("Width: "+this.getAutomata().getWidth(),10,40)}},Automata.CellStateProvider=class{getNextState(t){throw new Error("not implemented")}getColor(t){throw new Error("not implemented")}},Automata.CellularLayer=class extends Automata.Layer{#cells=[];#array=[];#cellStateProvider=null;constructor(t,e){super(t,e),e&&e.cellStateProvider&&this.setCellStateProvider(e.cellStateProvider),this.setAutoClear(!1)}#createCells(t){var e,s,a=this.getAutomata(),i=a.getHeight(),r=a.getWidth(),h=[];for(e=0;e<r;e++)for(h[e]=[],s=0;s<i;s++)h[e][s]=new Automata.Cell(this,e,s),!0===t&&h[e][s].setState(this.getCellStateAt(e,s)||0);for(this.#cells=h,this.#array=[],e=0;e<r;e++)for(s=0;s<i;s++)this.#cells[e][s].addNeighbor(this.getCellAt(e-1,s-1)),this.#cells[e][s].addNeighbor(this.getCellAt(e,s-1)),this.#cells[e][s].addNeighbor(this.getCellAt(e+1,s-1)),this.#cells[e][s].addNeighbor(this.getCellAt(e+1,s)),this.#cells[e][s].addNeighbor(this.getCellAt(e+1,s+1)),this.#cells[e][s].addNeighbor(this.getCellAt(e,s+1)),this.#cells[e][s].addNeighbor(this.getCellAt(e-1,s+1)),this.#cells[e][s].addNeighbor(this.getCellAt(e-1,s)),this.#array.push(this.#cells[e][s])}resize(){super.resize(),this.#createCells(!0)}clear(){this.#array.forEach((function(t){t.setState(0)})),this.setDirty(!0)}setCellStateProvider(t){this.#cellStateProvider=t}propagateEvent(t,e){var s=Math.floor(e.x/this.getAutomata().getStep()),a=Math.floor(e.y/this.getAutomata().getStep()),i=this.getCellAt(s,a);this.fireEvent("cell"+t,[this,i,e])}getArray(){return this.#array}getCellStateAt(t,e){var s=this.getCellAt(t,e);return s?s.getState():null}getCellAt(t,e){if(this.#cells[t])return this.#cells[t][e]}load(t){t.forEach((function(t){this.#cells[t.x][t.y].setState(t.state||1)}),this),this.setDirty(!0)}next(){var t=this.#cellStateProvider||Automata.DefaultCellStateProvider;this.#array.forEach((function(e){e.setNextState(t.getNextState(e))})),this.setDirty(!0)}redraw(t){var e=this.#cellStateProvider||Automata.DefaultCellStateProvider,s=this.getAutomata().getStep();this.#array.forEach((function(a){if(a.isDirty()){var i=a.applyNextState();0===i?t.clearRect(a.getX()*s,a.getY()*s,s,s):(t.fillStyle=e.getColor(i),t.fillRect(a.getX()*s,a.getY()*s,s,s))}}))}},Automata.Cell=class extends Automata.Object{#x=null;#y=null;#state=0;#nextState=null;#layer=null;#neighbors=[];constructor(t,e,s,a){super(a),this.#layer=t,this.#x=e,this.#y=s,a&&a.state&&this.setState(a.state)}addNeighbor(t){t&&this.#neighbors.push(t)}getLayer(){return this.#layer}getNextState(){return this.#nextState}getState(){return this.#state}getX(){return this.#x}getY(){return this.#y}getNeighbors(){return this.#neighbors}setNextState(t){this.#nextState=t}setState(t){this.#nextState=null,this.#state=t}isDirty(){return this.#nextState!=this.#state}applyNextState(){return null!==this.#nextState&&(this.#state=this.#nextState),this.#state}};
