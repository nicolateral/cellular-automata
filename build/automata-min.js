var Automata={Object:class{#options={};#events={};#binds={};constructor(t){this.setOptions(t)}bind(t,e){var i=this;this.#binds[t]||(this.#binds[t]=[]),this.#binds[t].push(e),e.element.addEventListener("change",(function(){i.setOption(t,e.get.call(e.element))})),e.set.call(e.element,this.getOption(t))}fireBind(t,e){this.#binds[t]&&this.#binds[t].forEach((function(t){t.set.call(t.scope||this,e)}),this)}listen(t,e){this.#events[t]||(this.#events[t]=[]),this.#events[t].push(e)}fireEvent(t,e){this.#events[t]&&this.#events[t].forEach((function(t){t.fn.apply(t.scope||this,e)}),this)}getOption(t){return this.#options[t]}getOptions(){return this.#options}setOption(t,e,i){this.#options[t]===e&&!0!==i||(this.#options[t]=e,this.fireBind(t,e),this.fireEvent(t+"change",[e]))}setOptions(t){var e;for(e in t)this.setOption(e,t[e])}}};Automata.Automata=class extends Automata.Object{#last=null;#layers=[];#element=null;#painted=!1;constructor(t,e){super(e),this.listen("widthchange",{fn:this.#updateWidth,scope:this}),this.listen("heightchange",{fn:this.#updateHeight,scope:this}),this.listen("stepchange",{fn:this.#updateStep,scope:this}),this.listen("startedchange",{fn:this.#updateStarted,scope:this}),this.#element=t,this.addLayer(new Automata.BackgroundLayer(this,{id:"background"})),this.addLayer(new Automata.InfoLayer(this,{id:"info"})).getCanvas().style.zIndex=10,this.addLayer(new Automata.Layer(this,{id:"event"})).getCanvas().style.zIndex=20,this.#initEventLayer()}#initEventLayer(){this.getLayer("event").getCanvas().addEventListener("mousedown",this.#onMouseDown.bind(this))}#getEventX(t){return t.layerX}#getEventY(t){return t.layerY}#onMouseDown(t){this.propagateEvent("mousedown",{x:this.#getEventX(t),y:this.#getEventY(t)})}#reziseLayers(){this.getLayers().forEach((function(t){t.resize()}))}#updateStep(){this.#reziseLayers(),this.isPainted()&&this.repaint()}#updateHeight(){this.#reziseLayers(),this.isPainted()&&this.repaint()}#updateWidth(){this.#reziseLayers(),this.isPainted()&&this.repaint()}#updateStarted(t){t&&this.repaint()}#requestAnimationFrame(){var t=this;requestAnimationFrame((function(){t.next(),t.repaint()}))}propagateEvent(t,e){this.getLayers().forEach((function(i){i.propagateEvent(t,e)}))}getElement(){return this.#element}addLayer(t){return this.#layers.push(t),t.resize(),t}addCellularLayer(t){return this.addLayer(new Automata.CellularLayer(this,t))}getLayer(t){var e,i=this.#layers;for(e=0;e<i.length;e++)if(i[e].getId()===t)return i[e];return null}getLayers(){return this.#layers}getStep(){return this.getOption("step")}getHeight(){return this.getOption("height")}getWidth(){return this.getOption("width")}getSize(){return{height:this.getHeight(),width:this.getWidth()}}isPainted(){return this.#painted}next(){this.getLayers().forEach((function(t){t.next()}))}repaint(){var t=this,e=Date.now(),i=this.getOption("delay");this.getOption("started")?(this.#last&&this.getLayer("info").setFPS(Math.round(1e3/(e-this.#last))),this.#last=e):this.getLayer("info").setFPS(0),this.getLayers().forEach((function(t){t.repaint()})),this.#painted=!0,t.getOption("started")&&(i?setTimeout((function(){t.#requestAnimationFrame()}),i):t.#requestAnimationFrame())}},Automata.Layer=class extends Automata.Object{#dirty=!0;#canvas=null;#automata=null;constructor(t,e){super(e),this.#automata=t,this.#createElement()}#createElement(){this.#canvas=document.createElement("canvas"),this.#canvas.id=this.getId(),this.#canvas.style.position="absolute",this.getAutomata().getElement().appendChild(this.#canvas)}propagateEvent(t,e){}resize(){var t=this.getAutomata(),e=t.getStep(),i=t.getHeight()*e,s=t.getWidth()*e;this.#canvas.height=i,this.#canvas.width=s,s<t.getElement().offsetWidth?this.#canvas.style.left=Math.round((t.getElement().offsetWidth-s)/2)+t.getElement().offsetLeft:this.#canvas.style.left=0,i<t.getElement().offsetHeight?this.#canvas.style.top=Math.round((t.getElement().offsetHeight-i)/2)+t.getElement().offsetTop:this.#canvas.style.top=0,this.setDirty(!0)}getAutomata(){return this.#automata}getCanvas(){return this.#canvas}getContext(t){return this.getCanvas().getContext(t)}getId(){return this.getOption("id")}setDirty(t){this.#dirty=t}isDirty(){return this.#dirty}next(){}repaint(){if(this.isDirty()){var t=this.getContext("2d"),e=this.getAutomata(),i=e.getSize(),s=e.getStep();t.clearRect(0,0,i.width*s,i.height*s),this.redraw(this.getContext("2d")),this.setDirty(!1)}}redraw(t){}},Automata.BackgroundLayer=class extends Automata.Layer{redraw(t){var e,i=this.getAutomata(),s=i.getSize(),a=i.getStep();for(t.beginPath(),t.strokeStyle="#F0F0F0",e=1;e<s.width;e++)t.moveTo(e*a,0),t.lineTo(e*a,s.height*a),t.stroke();for(e=1;e<s.height;e++)t.moveTo(0,e*a),t.lineTo(s.width*a,e*a),t.stroke();t.closePath()}},Automata.InfoLayer=class extends Automata.Layer{#fps=0;setFPS(t){this.#fps!==t&&this.setDirty(!0),this.#fps=t}redraw(t){t.clearRect(5,5,80,20),t.fillStyle="#FFFFFFDD",t.fillRect(5,5,40,20),t.fillStyle="#000000",t.fillText(this.#fps+" FPS",10,20)}},Automata.CellularLayer=class extends Automata.Layer{#cells=[];#array=[];constructor(t,e){super(t,e),this.listen("colorchange",{fn:this.#updateColor,scope:this}),this.listen("patternchange",{fn:this.#updatePattern,scope:this}),this.getOption("color")&&this.#updateColor(this.getOption("color")),this.getOption("pattern")&&this.#updatePattern(this.getOption("pattern"))}#createCells(t){var e,i,s=this.getAutomata().getSize(),a=[];for(e=0;e<s.width;e++)for(a[e]=[],i=0;i<s.height;i++)a[e][i]=new Automata.Cell(this,{x:e,y:i}),!0===t&&a[e][i].setAlive(this.isAliveAt(e,i));for(this.#cells=a,this.#array=[],e=0;e<s.width;e++)for(i=0;i<s.height;i++)this.#cells[e][i].addNeighbor(this.getCellAt(e-1,i-1)),this.#cells[e][i].addNeighbor(this.getCellAt(e,i-1)),this.#cells[e][i].addNeighbor(this.getCellAt(e+1,i-1)),this.#cells[e][i].addNeighbor(this.getCellAt(e+1,i)),this.#cells[e][i].addNeighbor(this.getCellAt(e+1,i+1)),this.#cells[e][i].addNeighbor(this.getCellAt(e,i+1)),this.#cells[e][i].addNeighbor(this.getCellAt(e-1,i+1)),this.#cells[e][i].addNeighbor(this.getCellAt(e-1,i)),this.#array.push(this.#cells[e][i])}#updateColor(){this.setDirty(!0),this.getAutomata().repaint()}#updatePattern(t){var e=this.getOption("patterns")[t]();this.#createCells(),this.load(e),this.getAutomata().repaint()}resize(){super.resize(),this.#createCells(!0)}clear(){this.#array.forEach((function(t){t.setAlive(!1)})),this.setDirty(!0)}propagateEvent(t,e){var i=Math.floor(e.x/this.getAutomata().getStep()),s=Math.floor(e.y/this.getAutomata().getStep());this.getCellAt(i,s).invert(),this.setDirty(!0),this.getAutomata().repaint(),this.#array.forEach((function(i){i.propagateEvent(t,e)}))}isAliveAt(t,e){var i=this.getCellAt(t,e);return!!i&&i.isAlive()}getCellAt(t,e){if(this.#cells[t])return this.#cells[t][e]}getColorCode(t){return this.getOption("colors")[this.getOption("color")](t)}load(t){t.forEach((function(t){this.#cells[t.x][t.y].setAlive(!0)}),this),this.setDirty(!0)}next(){this.#array.forEach((function(t){t.next()})),this.setDirty(!0)}redraw(t){var e=this.getAutomata().getStep();this.#array.forEach((function(i){i.redraw(t,e)}))}},Automata.Cell=class extends Automata.Object{#layer=null;#neighbors=[];#current=!1;#next=!1;constructor(t,e){super(e),this.#layer=t}addNeighbor(t){t&&this.#neighbors.push(t)}next(){var t=0;this.#neighbors.forEach((function(e){e.isAlive()&&(t+=1)})),this.isAlive()?2!==t&&3!==t&&(this.#next=!1):3===t&&(this.#next=!0)}redraw(t,e){this.#current=this.#next,this.#current&&(t.fillStyle=this.#layer.getColorCode(this),t.fillRect(this.getX()*e,this.getY()*e,e,e))}propagateEvent(t,e){}getLayer(){return this.#layer}getX(){return this.getOption("x")}getY(){return this.getOption("y")}setAlive(t){this.#current=t,this.#next=t}isAlive(){return this.#current}invert(){this.setAlive(!this.isAlive())}};
